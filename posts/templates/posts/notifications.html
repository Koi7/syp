{% extends "posts/base.html" %}
{% load static from staticfiles %}
{% block title %} Ищу Тебя | Уведомления {% endblock %}
{% block content %}
<!-- PAGE HEADER -->
<h1 class="w3-padding-tiny w3-center w3-text-awesome">Уведомления</h1>
<!-- UNREAD NOTIFICATIONS -->
{% if unread_notifications %}
<h3 class="w3-vk-card-noshadow w3-padding-tiny  w3-text-awesome">Новые</h3>
<ul id="unread_list" class="w3-ul w3-margin">{% include 'posts/includes/notifications_list.html' with notifications_list=unread_notifications %}</ul>
{% endif %}
<!-- LOAD MORE BUTTON -->
{% if unread_has_next %}
{% include 'posts/includes/load_more_button_with_loader.html' with src="unread" %}
{% endif %}
<!-- READ NOTIFICATIONS -->
{% if read_notifications %}
<h3 class="w3-vk-card-noshadow w3-padding-tiny w3-text-awesome">Просмотренные</h3>
<ul id="read_list" class="w3-ul w3-margin">{% include 'posts/includes/notifications_list.html' with notifications_list=read_notifications %}</ul>
{% endif %}
<!-- LOAD MORE BUTTON -->
{% if read_has_next %}
{% include 'posts/includes/load_more_button_with_loader.html' with src="read" %}
{% endif %}
<!-- NO NOTIFICATIONS -->
{% if not unread_notifications and not read_notifications %}
{% include 'posts/includes/no_results.html' with message="Нет увидомлений пока." %}
{% endif %}
{% endblock %}
{% block extra_scripts %}
<script>
	$(document).ready(function () {
		$('button.more-notifications').click(function () {
			$(this).toggle();
			$(this).next().toggle();
			var target = $(this).data('target');
			$.ajax({
				type: 'GET',
				url: '{% url "notifications_ajax" %}',
				data: {
					offset: $(this).data('offset'),
					target: target
				},
				dataType: "json",
				context: this,
				success: function (data) {
					$('ul#' + target + '_list').append(data.rendered_template);
					// increment if has next page
					if (data.has_next) {
						// hide loader
						$(this).next().toggle();
						//show button
						$(this).toggle();
						// increment
						if (target === "read") {
							$(this).data('offset', data.next_page);
						} else {
							$(this).data('offset', 1);
						}
						
					} else {
						// remove loader
						$(this).next().remove();
						// remove button
						$(this).remove();
					}
				},
				error: function (xhr, ajaxOptions, thrownError) {
					alertify.error(xhr.responseText);
				}
			});
		});
	});
</script>
{% endblock %}