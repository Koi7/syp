{% extends "posts/base.html" %}

{% load static from staticfiles %}

{% block title %}–ü–æ—Å—Ç—ã{% endblock %}

{% block content %}
	<!-- PAGE HEADER -->
	<h1 class="w3-padding-tiny w3-text-awesome w3-center">–ü–æ—Å—Ç—ã</h1>
{% if posts_list %}
{% for post in posts_list %}
		<!-- POST CARD -->
		<div data-post-id="{{ post.id }}" class="w3-vk-card w3-section .w3-custom-round-small w3-white">
			<!-- POST HEADER -->
			<header data-post-id="{{ post.id }}" class="w3-container w3-padding-large">
				<!-- USER PHOTO -->
				<img data-post-id="{{ post.id }}" src="{% static 'posts/images/blank/img_avatar2.png' %}" class="w3-left w3-circle w3-margin-right" style="width:50px">
				<div data-post-id="{{ post.id }}" class="w3-container w3-right">
					<!-- LIKE INDICATOR -->
						<a data-post-id="{{ post.id }}" href="{% url 'who_liked' post_id=post.id %}" class="link-no-style">
							<span data-post-id="{{ post.id }}" class="likes-amount w3-text-blue w3-padding-small">{{ post.likes }}</span>
						</a>
						<!-- PIPE -->
						<span data-post-id="{{ post.id }}" class="w3-text-gray w3-border-left pa-r-six"></span>
					<!-- LIKE BUTTON -->
					<i data-post-id="{{ post.id }}" class="fa fa-heart cursor-link w3-padding-small {% if post.id in request.user.vkuser.liked %} w3-text-red {% else %}  w3-text-blue {% endif %}" id="{{ post.id }}"></i>						
				</div>
				<!-- DISPLAY NAME OR ANONYMOUS -->
				<span data-post-id="{{ post.id }}" class="user-name">
					{% if not post.is_anonymous %}

						{{ post.user.first_name }} {{ post.user.last_name }}

					{% else %}

						–ê–Ω–æ–Ω–∏–º

					{% endif %}
				</span>
				<br>
				<!-- TIME PUBLISHED -->
				<span data-post-id="{{ post.id }}" class="w3-text-grey w3-small">{{post.pub_datetime|date:"d M"}} –≤ {{post.pub_datetime|time:"H:i"}}</span>
				<br>
				<!-- POST TAGS -->
				<span data-post-id="{{ post.id }}" class="w3-text-grey w3-small">—Ç—ç–≥–∏:</span>
				{% for post_tag in post.tags %}
				<span class="w3-red w3-padding-tiny w3-round w3-small">{{ post_tag.tag.value }}</span>
				{% endfor %}
			</header>
			<!-- POST TEXT -->
			<div data-post-id="{{ post.id }}" class="w3-container w3-padding-large">
			  <p data-post-id="{{ post.id }}" class="w3-medium post-text-normalize">{{ post.text }}</p>
			</div>
			<!-- POST CONTROLS (LIKE, MESSAGE, WHO LIKED) -->
			<footer data-post-id="{{ post.id }}" class="w3-container w3-border-top w3-padding-small">
				<!-- INPUT AND BUTTON -->
				<div data-post-id="{{ post.id }}" class="w3-row-padding">
					<div data-post-id="{{ post.id }}" class="w3-col m8 l10 w3-padding-4">
						<input data-post-id="{{ post.id }}" class="w3-input w3-cell no-border" type="text" placeholder="–û—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ">
					</div>
					<div data-post-id="{{ post.id }}" class="w3-col m4 l2 w3-padding-4">
						<button data-post-id="{{ post.id }}" class="w3-btn w3-white w3-text-blue w3-center"> –û—Ç–ø—Ä–∞–≤–∏—Ç—å <i class="fa fa-paper-plane-o" aria-hidden="true"></i> </button>
					</div>
				</div>
			</footer>
		</div>
{% endfor %}

{% else %}
        <div class="w3-container w3-padding-jumbo w3-center w3-text-gray">
            <h3>–í–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å.</h3>
            <span class="w3-jumbo">:(</span>
        </div>
{% endif %}

{% endblock %}

{% block extra_scripts %}

<script type="text/javascript">

function getCookie(name) {
  var value = "; " + document.cookie;
  var parts = value.split("; " + name + "=");
  if (parts.length == 2) return parts.pop().split(";").shift();
}


 $(document).ready(function () {
 	// add click event to each like icon
	// when click 
 	$('.fa-heart').click(function (){
 		var post_id = $(this).data('post-id');
 		$.ajax({
 			type: "POST",
 			url: "{% url 'like_post' %}", 			
 			data: {
 				post_id: post_id,
 				csrfmiddlewaretoken: getCookie('csrftoken')
 			},
 			context: this,
 			dataType: "json",
 			success: function (data){
 				if (data.is_created == '0'){
 					$(this).removeClass('w3-text-gray');
 					$(this).addClass('w3-text-red');
 				} else{
 					$(this).removeClass('w3-text-red');
 					$(this).addClass('w3-text-gray');
 				}
 				$('span.likes-amount[data-post-id=' + post_id + ']').text(data.likes_amount);
 			}
 		});
 	});

 	//click event handler
 	$('button').click(function () {
 		var post_id = $(this).data('post-id');
 		var input_value = $.trim($('input.w3-input[data-post-id=' + post_id + ']').val());
 		if (input_value.length > 0){
	 		$(this).html('–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—å—Å—è...');
	 		$(this).attr('disabled', true);
	 		$.ajax({
	 			type: "POST",
	 			url: "{% url 'leave_message' %}", 			
	 			data: {
	 				post_id: post_id,
	 				message: input_value,
	 				csrfmiddlewaretoken: getCookie('csrftoken')
	 			},
	 			context: this,
	 			dataType: "json",
	 			success: function (data){
	 				if (data.success){
	 					$(this).html('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ <i class="fa fa-check" aria-hidden="true"></i>');
	 					// update post state on front end
	 					// make icon red
 						$('i.fa-heart[data-post-id=' + post_id + ']').removeClass('w3-text-gray');
 						$('i.fa-heart[data-post-id=' + post_id + ']').addClass('w3-text-red');
	 					// change amount of likes
	 					$('span.likes-amount[data-post-id=' + post_id + ']').text(data.amount);
	 				}else{
	 					$(this).html('–£–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏!');
	 				}
 					//hide inputs
 					$('footer[data-post-id=' + post_id + ']').delay(2500).hide(300);
	 			}
	 		});

 		}
 	});



 });
</script>

{% endblock %}
<!-- LEGACY -->
		<!-- 
				<ul>
					<li>author: {{ post.user.id }} üòÄ</li>
					<li>text: {{ post.text }}</li>
					<li>place: {{ post.user.vkuser.place_str }}</li>
					<li>anon: {{ post.is_anonymous }}</li>
					<li>is actual: {{ post.is_actual }}</li>
					<li>pub date time: {{ post.pub_datetime }}</li>
					<li>tags: {% for post_tag in post.tags %} {{ post_tag.tag.value }} {% endfor %}</li>
					{% if request.user.id == post.user.id %}
						<li><a href="{% url 'edit_post' post_id=post.id %}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a></li>
						<form action="{% url 'delete_post' %}" method="POST">
							{% csrf_token %}
							<input type="hidden" name="post_id" value="{{ post.id }}">
							<input type="submit" value="–£–¥–∞–ª–∏—Ç—å">
						</form>
						<form action="{% url 'make_post_not_relevant' %}" method="POST">
							{% csrf_token %}
							<input type="hidden" name="post_id" value="{{ post.id }}">
							<input type="submit" value="–°–¥–µ–ª–∞—Ç—å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º">
						</form>
					{% endif %}
					<li>
						<form action="{% url 'like_post' %}" method="POST">
							{% csrf_token %}
							<input type="hidden" name="post_id" value="{{ post.id }}">
							<input type="submit" value="–õ–∞–π–∫">
						</form>
					</li>
					<li>
						<form action="{% url 'leave_message' %}" method="POST">{% csrf_token %}
							<input type="hidden" name="post_id" value="{{ post.id }}">
							<table>
								<tr>
									<td>
										–ü–æ—Å–ª–∞–Ω–∏–µ:
									</td>
									<td>
										<textarea name="message">
											
										</textarea>
									</td>
								</tr>
								<tr>
									<td></td>
									<td><input type="submit" name="" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å"></td>
								</tr>
							</table>
						</form>
					</li>
					<li>–õ–∞–π–∫–∏: {{ post.likes }}</li>
					<li><a href="{% url 'who_liked' post_id=post.id %}">–ö—Ç–æ –ª–∞–π–∫–Ω—É–ª?</a></li>
				{% if post.image %}
					<li>–ö–∞—Ä—Ç–∏–Ω–∫–∞ <img width="100" height="100" src="{{ post.image.url }}" alt="—Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"></li>
				{% endif %}
				</ul>
		-->