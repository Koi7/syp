{% extends "posts/base.html" %}

{% load static from staticfiles %}

{% block extra_links %}
    <link rel="stylesheet" type="text/css" href="{% static 'posts/styles/dist/forms.min.css' %}">
{% endblock %}

{% block extra_scripts_head %}
    <script src="{% static 'posts/js/util.js' %}"></script>
{% endblock %}

{% block title %}Профиль{% endblock %}

{% block content %}

<!-- PAGE HEADER -->
<h1 class="w3-padding-tiny w3-center w3-text-awesome">Профиль</h1>
<!-- CONFIRM PROFILE DELETION -->
<div id="delete_confirmation" class="w3-panel w3-pale-red w3-leftbar w3-border-red no-display">
    <p>Уверены что хотите удалить профиль ?<button id="delete_confirmation_yes" class="w3-btn w3-pale-red w3-text-red">Да</button> <button id="delete_confirmation_no" class="w3-btn w3-pale-red w3-text-blue">Нет</button></p>
</div>
<!-- PROFILE CARD -->
<div class="w3-vk-card w3-section .w3-custom-round-small w3-white">
    <!-- DELETE PROFILE BUTTON -->
    <button  id="delete_btn" class="w3-btn w3-white w3-text-blue  w3-padding-large">Удалить профиль <i class="fa fa-trash-o" aria-hidden="true"></i></button>
    <!-- PROFILE HEADER -->
    <header class="w3-container w3-padding-large w3-center">
        <!-- USER PHOTO -->
        <img src="{% static 'posts/images/blank/img_avatar2.png' %}" class="w3-circle w3-margin-right" style="width:100px">
        <br>
        <!-- USERNAME -->
        <span>{{ request.user.first_name }}  {{ request.user.last_name}}</span><br>
        <!-- PLACE & AGE -->
        {% if request.user.vkuser.place %}<span id="place" class="w3-text-gray">{{ request.user.vkuser.place_str }}</span>{% endif %}
        <span id="age" class="w3-text-gray">{% if request.user.vkuser.age > 0 %}{{request.user.vkuser.age}} лет{% endif %}</span>
        <!-- ABOUT -->
        {% if request.user.vkuser.about %}<p><span class="w3-text-gray">О себе:</span><span id="about">{{ request.user.vkuser.about }}</span></p>{% endif %}
    </header>
    <!-- CONTROLS -->
    <div id="profile_editor">
        <!-- CHANGE PLACE -->
        <div class="w3-container w3-padding-large pure-form">
            <p class="w3-text-gray">Город</p>
            <select id="place_input" class="w3-select" name="option">
                <option value="0" {% if request.user.vkuser.place == 0 %} selected {% endif %}>Севастополь</option>
                <option value="1" {% if request.user.vkuser.place == 1 %} selected {% endif %}>Симферополь</option>
                <option value="2" {% if request.user.vkuser.place == 2 %} selected {% endif %}>Ялта</option>
            </select>
        </div>
        <!-- SAVE -->
        <div class="w3-container w3-padding-large w3-center">
            <button id="save_btn" class="w3-btn w3-white w3-text-blue">Сохранить</button>
        </div>
    </div>
</div>
{% endblock content %}
{% block extra_scripts %}
<script type="text/javascript">

    $(document).ready(function () {

        // toggle inputa visibility
        $('#change').click(function(){
            $('#profile_editor').toggle(300);
        });

        //add event handler to save button
        $('#save_btn').click(function (){
            $(this).html("Отправляется...");
            $(this).attr('disabled', true);
            $.ajax({
                type: "POST",
                url: "{% url 'save_profile_editions' %}",
                data: {
                    csrfmiddlewaretoken: getCookie('csrftoken'),
                    place: $.trim($('#place_input').val()),
                    age: $.trim($('#age_input').val()),
                    about: $.trim($('#about_input').val())
                },
                context: this,
                dataType: "json",
                success: function(data){
                    if (data.success){
                        $(this).html("Отправлено");
                        // update user profile
                        $('#place').text(data.place);
                        $('#age').text(data.age + " лет");
                        $('#about').text(data.about);
                        // hide inputs
                        $('#profile_editor').delay(1000).toggle(300);
                        $(this).html("Сохранить");
                        $(this).attr('disabled', false);
                    }
                }
            });
        });

        //add handler to delete button
        $('#delete_btn').click(function () {
            $('#delete_confirmation').toggle(100);
        });

        $('#delete_confirmation_no').click(function(){
            $('#delete_confirmation').toggle(100);
        });

        $('#delete_confirmation_yes').click(function(){
            $.ajax({
                type: "POST",
                url: "{% url 'delete_user' %}",
                data: {
                    csrfmiddlewaretoken: getCookie('csrftoken')
                },
                dataType: "json",
                success: function(data){
                    if(data.success){
                        location.reload();
                    }
                }
            });
        });
    });
</script>
{% endblock %}